# JPA 연관관계
데이터베이스 관계 설정에는 4가지 관계가 존재하는데,

일대일, 일대다, 다대일, 다대다이며, JPA에서는 간단하게 어노테이션으로 표현이 가능하다.

![image](https://user-images.githubusercontent.com/85108615/196566312-2531439e-c494-4683-b2b1-623d70e0f31d.png)



한명의 USER가 여러개의 물건을 살때

![image](https://user-images.githubusercontent.com/85108615/196105526-449aaa82-516f-4736-8ccc-ffcde63c4090.png)


USER가 item_id를 갖게된다면, 한개의 물건밖에 살수없고,

또한 여러명의 user가 item을 살수있기때문에 한개의 유저id만 가질수는 없다.

즉 둘을 연결할수없기에 이 가운에에 새로운 테이블을 생성해 연결한다.

![image](https://user-images.githubusercontent.com/85108615/196105794-2c1a25c8-5558-4623-855a-cd22fa0ba0a6.png)

실습을 하기위해 먼저 데이터베이스를 만들어보자.

### 데이터베이스 만들기

1. mysql - database - Reverse Engineer 클릭

접속할 데이터베이스정보와, 계정 넣기.

study와 연결할것이니 study선택

![image](https://user-images.githubusercontent.com/85108615/196106624-8a847428-d7d9-4aca-bd06-85ddf73916b3.png)

finish까지 완료되면

![image](https://user-images.githubusercontent.com/85108615/196106742-91c4bb44-537c-4aa2-9ded-8a55955d14f3.png)

2. 왼쪽의 테이블추가 버튼클릭 

![image](https://user-images.githubusercontent.com/85108615/196107167-5d7a6be8-cc8c-4402-a3fe-0e6106882c6e.png)

새로생성된 테이블을 더블클릭하여, 칼럼을 추가한다.

![image](https://user-images.githubusercontent.com/85108615/196107419-3e9573af-7806-4290-a76c-177ffd619247.png)

### order_detail 테이블만들기

동일하게 테이블추가 아이콘클릭하여, order_detail을 만든다.

id와 order_at만 넣어주고, 

![image](https://user-images.githubusercontent.com/85108615/196108525-6ef2c0de-1fdb-4be6-b3f3-a97d144d917f.png)

순서를 맞춰 자리잡아준다.

![image](https://user-images.githubusercontent.com/85108615/196108578-aafd85a7-cc3d-4896-8c78-9e349540a260.png)

그리고 메뉴봐의 실선과 점선을 이용하는데

실선은 양쪽이 기본키를 가질때, 점선은 한쪽이 가질때

user와 order_detail은 1:N이니까 1:n점선으로 order_detail찍고 user찍어주기

![image](https://user-images.githubusercontent.com/85108615/196109079-c397969f-b1f7-4b61-83a8-5460686c5cb2.png)


마찬가지로 order_detail찍고 item찍기

![image](https://user-images.githubusercontent.com/85108615/196109222-2de58b2a-2e17-4fa3-8f77-1b976af72098.png)


### ERD를 테이블로 만들기

반대로  mysql - database - forward Engineer 클릭

select할 테이블 선택후 재접속 또는 새로고침하면 만든 테이블들이 생성된다.

-------------------------------------------------------------------------

# 코딩하기

### entity만들기

1. Item entity


db 테이블을 만들었다면, 그에맞는 ENTITY를 만든다.

프로젝트 > model 폴더 > entity 폴더 > Item class생성

@Data, @Entity어노테이션을 달고

멤버변수는 데이터베이스에서 설정한 칼럼과 동일하게 맞춰주기

![image](https://user-images.githubusercontent.com/85108615/196567167-86b70b72-a751-4bd3-a55d-94dff4d183f1.png)


```java
package com.example.study.model.entity;

import lombok.Data;

import javax.persistence.Entity;

@Data
@Entity
public class Item {

    private  Long id;

    private  String name;

    private  Integer price;

    private String content;


}


```

그리고, id가 식별자이기때문에

@Id와 @GeneratedValue 어노테이션을 달아준다.


```java
package com.example.study.model.entity;

import lombok.Data;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Data
@Entity
public class Item {


    @Id 
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private  Long id;

    private  String name;

    private  Integer price;

    private String content;

}
```

그리고 @AllArgsConstructor
@NoArgsConstructor 어노테이션을 달아주는데,

앞으로 @Data
@AllArgsConstructor
@NoArgsConstructor 어노테이션은 기본설정으로 한다.



2. OrderDetail entity

db를 참고하여, 

1과 동일한 방법으로 OrderDetail의 entity를 만들어준다.

이때 자바에서는 카멜케이스를 사용하고, db에서는 스네이크케이스를 사용하므로,

이름이 같다면 알아서 db와 연결된다.

```java
package com.example.study.model.entity;


import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import java.time.LocalDateTime;

@Data
@AllArgsConstructor
@NoArgsConstructor
@Entity //자바는 카멜케이스, db는 스네이크케이스
public class OrderDetail {

    @Id
    @GeneratedValue()
    private  Long id;

    private LocalDateTime orderAt;

    private Long userId;

    private Long itemId;
}

```

3. ItemRepository 생성
프로젝트 > repository 폴더 > ItemRepository 인터페이스 생성

Repository어노테이션달기 > jpa상속 > 넘겨줄 객체와 식별자(id)타입 적기 

```java
package com.example.study.repository;

import com.example.study.model.entity.Item;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface ItemRepository extends JpaRepository<Item, Long> {
}

```

4. 동일하게 OrderDetailRepository 생성

```java
package com.example.study.repository;

import com.example.study.model.entity.Item;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface OrderDetailRepository extends JpaRepository<Item, Long> {
}

```

5. TEST하기

여기까지 ENTITY와 REPOSITORY를 만들었다면, 잘되는지 테스트해보자.

test폴더 > repository > ItemRepositoryTest class 생성 > StudyApplicationTests 상속 

처음에 기본생성되어있던 StudyApplicationTests를 상속받는다.

```java
package com.example.study.UserRepository;

import com.example.study.StudyApplicationTests;

public class ItemRepositoryTest extends StudyApplicationTests {
}

```
ItemRepository를 테스트할것이니 @Autowired

```java
package com.example.study.UserRepository;

import com.example.study.StudyApplicationTests;
import com.example.study.repository.ItemRepository;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;

public class ItemRepositoryTest extends StudyApplicationTests {

    @Autowired
    private ItemRepository itemRepository;

    @Test
    public void create(){
    
        Item item = new Item();
        item.setName("노트북");
        item.setPrice(100000);
        item.setContent("삼성 노트북");

       Item newItem = itemRepository.save(item); //정상적으로 save되었다면,
       Assert.notNull(newItem,"새로운아이템"); //notnull이다.}
}

```

read도 작성하여 테스트해보자.

```java

   @Test
    public void read(){
         Long id =1L;

         Optional<Item> item = itemRepository.findById(id); //있을수도 없을수도있으니 optional

        item.ifPresent(i-> {
            System.out.println(i);
        });

    }
```



